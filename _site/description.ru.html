<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Aiai project | Aiai project</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Aiai project" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Aiai project" />
<meta property="og:description" content="Aiai project" />
<link rel="canonical" href="http://localhost:4000/description.ru.html" />
<meta property="og:url" content="http://localhost:4000/description.ru.html" />
<meta property="og:site_name" content="Aiai project" />
<script type="application/ld+json">
{"url":"http://localhost:4000/description.ru.html","headline":"Aiai project","description":"Aiai project","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=cc97aec4ca2943d233888052439638a49c173984">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Aiai project</h1>
        <p class="header">Aiai project</p>

        <ul>
          
          <li><a class="buttons github" href="http://github.com/sergmain/aiaii">View On GitHub</a></li>
        </ul>

        
          <p class="header">This project is maintained by <a class="header name" href="http://github.com/sergmain">sergmain</a></p>
        

        
      </header>

      <section>
        <p>Общее описание</p>

<ol>
  <li>Сущности, общая концепция</li>
</ol>

<p>1.1 Общая концепция
логически Aiai состоит из 2-ух верхнеуровневых модулей:</p>
<ul>
  <li>launchpad - стартовая площадка</li>
  <li>station - станция</li>
</ul>

<p>Стартовая площадка используется для управления заданиями, которые будут обрабатываться на станциях.
Станции могут получать задания от неограниченного количества стартовыз площадок.
Выбор стартовой площадки у которой необходимо запросить новое задание на выполнение осучествляется
на основе Round-robin алгоритма.</p>

<p>1.2 Plan (поток)
Поток - это описатель содержащий описания процессов, котрые будут выполняться для перобразования
данных из начальной формы в конечную. Поток, как описатель, не содержит состояния
выполнения процесса преобразования данных.</p>

<p>1.3 Workbook (реализация потока)
Реализация потока - это сущьность, которая включает в себя инфрмацию о выполнении преобразования данных.</p>

<p>1.4 Resource (ресурс)
Ресурс - это данные, которые используются или создаются в процессе преобразования данных потоком.
Ресурны бывают 2-ух типов - DATA (данные), SNIPPET(спипет)
Данные - это все что загружается в снипеты или или является продуктов их работы.
Снипет, как ресурс - это исполняемый код, который соответствует одному из описателей снипетов</p>

<p>1.5 Snippet (спипет)
Снипет - это описатель исполняемого кода, который будет вызываться при выполнении задачи.</p>

<p>1.6 Task (задача)
Задача - описание, что нужно выполнить, с какими параметрами, какой результат получить</p>

<ol>
  <li>Общая схема взаимодействия сушностей</li>
</ol>

<p>2.1 для того , чтобы обработать данные необходимо выполнить следующие шаги:</p>
<ul>
  <li>загрузить снипеты, которые будут использоваться при преобразовании данных</li>
  <li>создать и загрузить исходные данные, которые будут использоваться
как входные данные для всего преобразования.</li>
  <li>создать поток</li>
  <li>выполнить валидацию созданного потока. Если есть ошибки - исправить, повторить валидацию.
если все ок, то перейти к следующему шагу</li>
  <li>после успешной валидации можно создать реализацию потока. Реализация включает в себя
код набора входных ресурсов, ссылку на Поток, который надо преобразовать.</li>
  <li>сгенерировать задачи для реализации потока
 стадии: PROCESSING - задачи генерятся, PROCESSED - задачи сгенерированы</li>
  <li>запустить задачи для данного потока
 стадии: STARTED - задачи выполняются, STOPPED - выполнение новых задач для данной реализвации потока
 остановлено, FINISHED - все задачи для данной реализации потока выполнены</li>
</ul>

<ol>
  <li>Установка</li>
</ol>

<p>Устанавливать стартовую площадку можно в любом окружении, где есть доступ к mysql или postgresql
установка станции на этом же сервере не рекомендуется для прода,
и имеет смысл только для целей разработки и тестирования</p>

<p>3.1 Директории</p>
<ul>
  <li>для конфигурации стартовой площадки надо выбрать и создать рабочий директорий,
в котором стартовая площадка будет создавать свои артифакты</li>
  <li>выбрать директорий, в котором будет запускаться собственно Aiai. Рекомендуемая схема директориев:
\aiai - главный директорий для aiai
\aiai\config - директорий, в котором будет находиться application.properties конфиг файл
\aiai\git - в данный директорий будет делаться clone из git
\aiai\launchpad - директорий для стартовой площадки
\aiai\station - директорий для станции</li>
</ul>

<p>3.2 git
перейти в \aiai  (или другой директорий, который выбран, как основной)
выполнить команду
git clone https://github.com/sergmain/aiai.git git</p>

<p>3.3 Сборка
для сборки проекта требуется java8
в директории \aiai\git запустить
mvn-all.bat</p>

<p>3.4 Database
создать нового пользователя и схему(базу данных).</p>

<p>используя соответствующий скрипт создать таблицы в БД в созданной ранее схеме
MySql       - sql/db-mysql.sql
Postgresql  - sql/db-postgresql.sql</p>

<p>3.5 application.properties
за основу можно взять файл, который доступен по url -
https://github.com/sergmain/aiai/blob/master/apps/aiai/src/main/resources/application.properties</p>

<p>при этом заменив значения из окружения на конкретные значения</p>

<p>3.5.1 общие значения для стартовой площадки и станции
aiai.thread-number=3
определяет количество потоков, которые будет использоваться для паралельной работы aiai
делать количество потоков больше, чем количестов виртуальных ядер (ядер с учетом гипер-трединга) смысла нет.</p>

<p>3.6 Стартовая площадка
3.6.1 application.properties для стартовой площадки
конфигурация конфиг файла заключается в задании следующий параметров</p>

<p>spring.profiles.active=launchpad</p>

<p>для mysql
spring.datasource.url = jdbc:mysql://localhost:3306/aiai?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=CONVERT_TO_NULL&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;maxReconnects=10&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=America/Los_Angeles
spring.datasource.username = aiai
spring.datasource.password = qwe321
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL57Dialect</p>

<p>временную зону для mysql выбрать согласно документации на mysql и изменить в spring.datasource.url
в приведеном выше примере временная зона - serverTimezone=America/Los_Angele</p>

<p>для postgresql
spring.datasource.url=jdbc:postgresql://host:5432/database?user=abc&amp;password=xxx&amp;sslmode=require
spring.datasource.username=abc
spring.datasource.password=xxx
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQL95Dialect</p>

<p>указать специфические для стартовой площадки параметры:</p>

<p>======================
aiai.launchpad.enabled=true
aiai.launchpad.dir=./aiai-launchpad
aiai.launchpad.is-replace-snapshot=true</p>

<p>aiai.launchpad.is-ssl-required=false
aiai.launchpad.secure-rest-url=true</p>

<h1 id="password---123">password - 123</h1>
<p>aiai.launchpad.master-password=$2a$10$jaQkP.gqwgenn.xKtjWIbeP4X.LDJx92FKaQ9VfrN2jgdOUTPTMIu
aiai.launchpad.master-username=q
aiai.launchpad.master-token=1</p>

<p>aiai.launchpad.rest-password=$2a$10$jaQkP.gqwgenn.xKtjWIbeP4X.LDJx92FKaQ9VfrN2jgdOUTPTMIu
aiai.launchpad.rest-username=q1
aiai.launchpad.rest-token=11</p>

<h1 id="aiailaunchpadpublic-key-miibijanbgkqhkig9w0baqefaaocaq8amiibcgkcaqeats3jrje1wlhcxiqn6fcrvtahrt6lbvhrqxzgo1fcpj9uzvrumf3kwszwqolypw7am9oxmg15qpsskcrulsofdfbuusiydny7wmlil1h11svqm3ygwml9gjz2fuparwpyzkimj1iladhyltudqcbojgjbwymcdn2kzh5epv7hkhhfjz2nricayqvmmkoikcxr8q1bb3qnq2himyusbugzeo2duvx4n375safidrse4egnvbrimww7ted4wk0h5kj2vtdgl2j7gvs7gccmwbn9tvxperrdxgotxres8vrud0hoziadx12kjwi4mjhc4qgexaq2sc1dov8widaqab">aiai.launchpad.public-key= MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtS3jRjE1wlHcxiqn6fCRvTahRt6LBvhrqxzgo1FcpJ9uZvRUmf3KwszwQoL+Ypw7aM9oxmg15Q+pssKcrulS/ofDfbuusiYdny7wMlil1H11svQM3yGwMl9gjZ2FupaRwpyZkIMj1ILaDhylTudQCBoJgJ/BWyMCDn2kzh5EpV7hkhhfjZ/2/NRIcayQVmMKOikCXR8q1bb3QNQ2HiMyUsBUGzeO2DuvX4n375+SaFIDrse4eGNVbR/ImWw7TeD4wk0h5kJ2VTdgl2J7gVS7gCCMwBN9TVxPErRDxg/OtXreS8VRUd0hOZiadX12KjwI4mjhC4q+geXAq2sC1DOV8wIDAQAB</h1>

<p>aiai.launchpad.is-replace-snapshot - можно ли перезаписывать snapshot-спипеты новыми версиями</p>

<p>aiai.launchpad.is-ssl-required - все взаимодействия со стартовой площадкой только через SSL
по умолчанию использование SSL для всех http запросов включено.
Для контороля SSL используется параметр aiai.is-ssl-required
Например:
aiai.launchpad.is-ssl-required=false</p>

<p>Отключать SSL рекомендуется только, если aiai  (как стартовая площадка, так и станция) запускается
на localhost или когда станции и стартовая площадка распологаются в одной DMZ</p>

<p>aiai.launchpad.secure-rest-url - нужен ли пароль/логин для защиты rest урл</p>

<p>aiai.launchpad.master-* - данные для аутенсификации для web интерфейса
aiai.launchpad.rest-* - данные для аутенсификации дл rest урл</p>

<p>для aiai.launchpad.public-key необходимо использовать приложение из apps/gen-keys</p>

<p>для
aiai.launchpad.rest-password
aiai.launchpad.master-password
необходимо использовать приложение из apps/gen-passwords</p>

<p>-username и -token выбираются самостоятельно, но не могут включать в себя символ ‘=’ (символ равно)</p>

<p>3.7 Станция
3.7.1 application.properties для станции
spring.profiles.active=station</p>

<p>aiai.station.enabled=true
aiai.station.dir=./aiai-station</p>

<p>aiai.station.launchpad-url=http://host:8080
aiai.station.server-rest-password=123
aiai.station.accept-only-signed-snippets=false
aiai.station.active-time: 0:00-8:45, 19:00-23:59</p>

<p>aiai.station.launchpad-url - url по которому находится стартовая площадка
для aiai.station.server-rest-password необходимо испольховать тот же пароль,
что использовался для aiai.launchpad.rest-password, только в незашифрованном виде
параметр aiai.station.active-time используется для определение периода времени, когда
станция будет выполнять вычисления. стартовое время и конечное включаются в активный период
последним времене в сутка является 23:59
количество периодов неограничено, каждый период должен отделяться запятой</p>

<p>параметр aiai.station.accept-only-signed-snippets настоятельно рекомендуется установить
в true, если старновая площадка находится за пределами DMZ</p>

<p>3.7.2 Конфигурация launchpad.yaml
Для конфигурации стартовых площадок, с которыми будет взаимодействовать конкретная станция используется
конфиг файл launchpad.yaml. Данный файл должен располагаться в директории который является главным для станции,
в данном руковосдстве это \aiai\station
формат файла:
launchpads:</p>
<ul>
  <li>signatureRequired: false
securityEnabled: true
url: http://localhost:8080
lookupType: direct
authType: basic
restPassword: 123
restUsername: q1
restToken: 11
taskProcessingTime: 0:00 - 23:59
publicKey: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtS3jRjE1wlHcxiqn6fCRvTahRt6LBvhrqxzgo1FcpJ9uZvRUmf3KwszwQoL+Ypw7aM9oxmg15Q+pssKcrulS/ofDfbuusiYdny7wMlil1H11svQM3yGwMl9gjZ2FupaRwpyZkIMj1ILaDhylTudQCBoJgJ/BWyMCDn2kzh5EpV7hkhhfjZ/2/NRIcayQVmMKOikCXR8q1bb3QNQ2HiMyUsBUGzeO2DuvX4n375+SaFIDrse4eGNVbR/ImWw7TeD4wk0h5kJ2VTdgl2J7gVS7gCCMwBN9TVxPErRDxg/OtXreS8VRUd0hOZiadX12KjwI4mjhC4q+geXAq2sC1DOV8wIDAQAB
acceptOnlySignedSnippets: false</li>
</ul>

<p>Описание параметров:
signatureRequired: пребуется ли подпись (в настоящее время не используется)
securityEnabled: rest урл защищен логин/паролем
url: урл стартовой площадки / регистра,
    если lookupType==direct, то url это адрес стартовой площадки,
    если lookupType==registry, то url это адрес регистра стартовых площадок
lookupType: см параметр url
authType: тип аутенсификации, basic - стандартная BASIC аутенсификация, oauth - аутенсификация по OAuth2.0
restPassword: пароль для rest урл
restUsername: пароль для rest
restToken: токен для rest
taskProcessingTime: время, когда задачи с данной стартовой площадки активны,
    например 0:00 - 23:59 или 0:00 - 8:45, 19:00 - 23:59
publicKey: публичный ключ для данной стартовой площадки
acceptOnlySignedSnippets: принимать только подписанные снипеты</p>

<p>для publicKey необходимо использовать приложение из apps/gen-keys, подробнее см “Конфигурация стартовой плащадки”</p>

<p>3.8 Конфигурация spring.profiles.active
в настоящее время в aiai поддерживается 2 профиля - launchpad и station
эти профили можно использовать как по отдельности, так и комбинировать. В любом случаев,
в файле application.properties должна быть только ОДНА строка spring.profiles.active=
Например:
spring.profiles.active=launchpad
или
spring.profiles.active=launchpad, station
или
spring.profiles.active=station</p>

<p>3.9 конфигурация Http сервера на стороне стартовой площадки
3.9.1 IP адрес
для точного указания на какой IP адрес биндить http используется параметр server.address
Например:
server.address=127.0.0.1</p>

<ol>
  <li>apps/gen-keys
для генерации ключей необходимо запустить</li>
</ol>

<p>java -jar apps/gen-keys/target/gen-keys.jar</p>

<p>новые ключи (публичный и частный) будут напечатаны в консоле</p>

<ol>
  <li>apps/gen-passwords</li>
</ol>

<p>для генерации ключей в формате aiai (bcrypt, 10 циклов) запустить</p>

<p>java -jar apps/gen-keys/target/gen-passwords.jar <master password=""> <rest password=""></rest></master></p>

<p>результат работы поместить в соответствующие параметры:
master password –&gt; aiai.launchpad.master-password
master token –&gt; aiai.launchpad.master-token</p>

<p>rest password –&gt; aiai.launchpad.rest-password
rest token –&gt; aiai.rest-token</p>

<p>токены могут быть изменены по желанию,
но не должны быть пустыми и включать в себя символ ‘=’ (символ равно)</p>

<ol>
  <li>Запуск
для запуска aiai (как стартовой плошадки, так и станции) необходимо
из директория \aiai запустить команду</li>
</ol>

<p>java -jar git/apps/aiai/target/aiai.jar</p>

<p>6.1 обновление кодовой базы
для того чтобы забрать последние изменения в проекте необходимо перейти в \aiai\git
и выполнить команды:</p>

<p>git pull origin master
mvn-all.bat</p>

<ol>
  <li>Управление стартовой площадкой
после того, как все параметры были прописаны, можно запустить стартовую площадку
по адресу на котором она была запущена
логин - aiai.master-username=aiai.master-token
пароль - aiai.launchpad.master-password</li>
</ol>

<p>т.е если
aiai.master-username=yyy
aiai.master-token=xxx</p>

<p>то логин будет - yyy=xxx</p>

<p>если все запустилось успешно, то можно перейти к созданию сущеностей</p>

<ol>
  <li>Plan (поток)
создать простейший поток, состоящий из одного процесса.
Создать поток можно перейдя по адресу /launchpad/plan/plan-add</li>
</ol>

<p>значения полей:
Code of plan –&gt;  simple-plan</p>

<p>Parameters of plan –&gt;</p>

<p>processes:</p>
<ul>
  <li>code: simple-app
collectResources: false
name: Simple snippet
inputType: simple-resource-pool
outputType: simple-result
snippetCodes:
    <ul>
      <li>simple-app:1.1
type: FILE_PROCESSING
parallelExec: false</li>
    </ul>
  </li>
</ul>

<p>сразу после создания данный поток не будет валиден
т.к. необходимо создать сниппет simple-app:1.1</p>

<ol>
  <li>Снипет
создание снипета, который будет загружен через стартовую площадку состоит из неслоких этапов
    <ul>
      <li>создать приложение, которое будет обрабатывать данные</li>
      <li>создать конфиг описания снипета</li>
      <li>запаковать снипет приложением apps/package-snippet</li>
      <li>если окружение сконфигурировано на использование только подписанных снипетов,
то при паковке снипета так же подписать его используя приватный ключ</li>
    </ul>
  </li>
</ol>

<p>9.1 снипет без исполняемого кода
для простоты мы будем создавать снипет, который не содержит исполняемый код</p>

<p>9.2 конфиг снипета
отсутствие необходимости иметь исполняемый код помечается в
fileProvided=true</p>

<p>snippets:
    - name: simple-app
      version: 1.1
      type: simple
      env: simple-app
      fileProvided: true</p>

<p>сама ссылка на исполняемое приложение конфигурируется в env: simple-app</p>

<p>9.3 подписание снипета
создать временный директорий и в нем создать файл snippets.yaml
поместить в данный файл конфиг снипета
snippets:
    - name: simple-app
      version: 1.1
      type: simple
      env: simple-app
      fileProvided: true</p>

<p>используя приложние apps/package-snippet запаковать и подписать снипет</p>

<ol>
  <li>apps/package-snippet</li>
</ol>

<p>для запаковывания снипета и его подписания необходимо запустить</p>

<p>java -jar apps/package-snippet/target/package-snippet.jar snippet.zip ../private-key.txt</p>

<p>первый параметр (в примере это snippet.zip) указывает название архива в который будет запакован снипет
если второй параметр определен, то снипет будет подписан.
второй параметр это путь до файла с частным ключом. Частный ключ генерится приложением gen-keys</p>

<ol>
  <li>загрузка снипетов
используя веб-интерфейс стартовой площадки загрузить снипет, перейдя по адресу</li>
</ol>

<p>http://localhost:8080/launchpad/snippets</p>

<p>после успешной загрузки снипета проверка потока больше не должна выдавать сообщние, что снипет
не обнаружен</p>

<ol>
  <li>окружение станции
12.1 env.yaml
для того, чтобы снипеты запускались на стороне станции необходимо сконфигурировать
исполняемое окуржение. для этого необходимо создать файл \aiai\station\env.yaml</li>
</ol>

<p>конфиг:
envs:
  simple-app: java -jar C:\aia\git\apps\simple-app\target\simple-app.jar</p>

<p>в нашем примере исполяемой командой будет запуск простого приложения</p>

<p>12.2 app/simple-app
данное приложение должно быть уже собрано после выполнения команды mvn-all.bat
для провеки необходимо из командной строки запустить:
java -jar C:\aia\git\apps\simple-app\target\simple-app.jar</p>

<p>если все приложение simple-app собрано успешкно то в консоле будет выведено:
Parameter file wasn’t specified</p>

<ol>
  <li>Загрузка данных
для инициализации данных для обработки нашим снипетом загрузим любой текстовый файл
через интерфейс работы с ресурсами</li>
</ol>

<p>http://localhost:8080/launchpad/resources</p>

<p>указать
Resource code - simple-resource
Resource pool code - simple-resource-pool</p>

<ol>
  <li>Создание реализации потока (Workbook)
перейти по адресу
http://localhost:8080/launchpad/plan/plans</li>
</ol>

<p>и выбрать поток, который мы ранее создали</p>

<p>и затем нажать кнопку ‘Instances’</p>

<p>Создать новую реализацию потока:
Input pool code for this plan - simple-resource-pool</p>

<p>List of plans - simple-plan</p>

<ol>
  <li>запуск реализации потока</li>
</ol>

<p>после успешного создания реализации потока (Plan Instance) запустить генерацию задач
нажав кнопку “Produce”</p>

<p>дождаться когда статус будет изменен с PRODUCING на PRODUCED
примечание. в настоящее время автоматическое обновление старницы не реализовано.</p>

<p>Запустить поток на выполнение нажатием кнопки “Start”</p>

<p>в директории \aiai\station\task
должен появиться директорий 0 и в нем директорий с номером задачи.
в директории \aiai\station\task\0\xxx\artifacts после выполнения задачи
будет содан файл system-console.log в котором будет выведно содержимое файла,
который мы загрузили как ресурс.</p>


      </section>

      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
